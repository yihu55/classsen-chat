<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-commerce</title>
</head>

<body>

    <input type="number" id="input">
    <button id="button">Filtera på rating</button>

    <div id="total">Total:0</div>
    <div id="itemContainer"></div>

    <script>
        const url = "https://mock-data-api.firebaseio.com/e-commerce/products.json"
        const itemContainer = document.getElementById("itemContainer")
            //const total = document.getElementById("total")
            //fetch data
        function getItemsData() {
            fetch(url)
                .then(res => res.json())
                .then(data => {
                    //console.log(data)
                    renderItemList(data)
                    filterItems(data)

                })
        }

        //render data
        function renderItemList(data) {
            Object.values(data).forEach(item => {
                //console.log(item){description:...images:...etc}
                renderItems(item)
            })
        }

        function filterItems(data) {
            Object.values(data).filter(item => {
                //console.log("item.rating > 4.5" + item.rating > 4.5)
                if (item.rating > 4.5) {
                    //console.log(item)
                    return item
                }
            })
        }
        //create place for name
        function getName(item) {

            const name = document.createElement("h1")
            name.innerText = `${item.name}`
            return name
        }
        //create place for price
        function getDescription(item) {

            const description = document.createElement("h3")
            description.innerText = `description: ${item.description}`
            return description
        }

        function getPrice(item) {
            const price = document.createElement("p")
            price.innerText = `price: ${item.price} kr`
                //console.log(item.price)
            return price
        }
        //create place for image
        function getImage(item) {
            const image = document.createElement("img")
            image.src = item.images[0].src.small
            image.alt = item.images[0].alt
            image.style.width = "50%"
            image.addEventListener("click", () => {
                    //console.log(renderShoppingCart(item))
                    renderShoppingCart(item)
                    const total = document.getElementById("total")
                    total.innerHTML = `Total:${calculateTotalPrice(item)}` //??separera function

                })
                //image.addEventListener("click", renderShoppingCart(item))
            return image
        }

        //create place for rating
        function getRating(item) {
            const rating = document.createElement("p")
            rating.innerText = `Rating: ${item.rating}`
            return rating
        }

        //create place for stock status
        function getStock(item) {
            const stock = document.createElement("p")
            stock.innerText = `in stock: ${item.stock}`
            return stock
        }
        //place elements => wrapper =>itemContainer 
        function renderItems(item) {
            const wrapper = document.createElement("div")
            wrapper.appendChild(getName(item))
            wrapper.appendChild(getImage(item))
            wrapper.appendChild(getDescription(item))
            wrapper.appendChild(getPrice(item))
            wrapper.appendChild(getRating(item))
            wrapper.appendChild(getStock(item))
            wrapper.appendChild(buyButton(item))

            itemContainer.appendChild(wrapper)
        }
        //store all prices to substract
        let prices = []

        function calculateTotalPrice(item) {
            let total = 0
            prices.push(item.price)
                //console.log(total)
                //console.log(prices)
            prices.forEach(price => {
                total += price
                    //console.log(total)

            })
            console.log("total" + total)
            return total

        }

        function renderShoppingCart(item) {
            //renderar ut varas namn och pris i Varukorg wrapper
            const varukorgWrapper = document.createElement("p")
            const li = document.createElement("li")
            li.innerHTML = `${item.name} - ${item.price}`
            varukorgWrapper.appendChild(li)
            itemContainer.prepend(varukorgWrapper) //message hamnar högst i itemContainer
            return varukorgWrapper

        }

        function buyButton(item) {
            const wrapper = document.createElement("p")
            const button = document.createElement("button")
            button.innerText = "köp"
            button.addEventListener("click", () => {
                renderShoppingCart(item)
                    //calculateTotalPrice(item)
                const total = document.getElementById("total")
                total.innerHTML = `Total:${calculateTotalPrice(item)}`
            })

            wrapper.appendChild(button)

            return wrapper
        }

        // function filter() {

        //     const button = document.getElementById("button")

        //     button.addEventListener("click", () => {
        //             const input = document.getElementById("input").value
        //             console.log(input)
        //                 //return input
        //                 //filterItems(data, input)
        //         })
        //         //filterItems(data)

        // }


        getItemsData()
    </script>
</body>

</html>